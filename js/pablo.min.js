$(document).ready(function(){function t(t){l.fillStyle="rgb(245, 139, 87)",l.fillRect(0,0,a.width,a.height),l.fillStyle="rgb(0, 0, 0)";var e=document.getElementById("image");l.drawImage(e,0,0,e.width,e.height,194*t,1152*t,348*t,243*t);var o=$("#text").val().replace(/ /g,"  ");for(l.font="bold "+s*t+"px Helvetica, Arial, sans-serif",i=0;i<g.length;i++)for(j=0;j<8;j++)l.fillText(o,g[i][0]*t,g[i][1]*t+j*f*t);n()}function e(e,i,n){$("#pablo").css("width",c+"px"),a.height=c,a.width=c,t(1),alert(e),e.attr("href",document.getElementById(i).toDataURL()),e.attr("download",n),o()}function n(){var t=2*$("#text").val().length;$("#text").focus(),$("#text")[0].setSelectionRange(t,t)}function o(){$("#pablo").css("width",r+"px"),d=r/c,a.height=r,a.width=r,t(d)}var a=document.getElementById("pablo");if(!a)return void alert("Impossible de récupérer le canvas");var l=a.getContext("2d");if(!l)return void alert("Impossible de récupérer le context du canvas");var c=1500,r=1024,d=r/c,u=500,s=40,g=[[122,129],[127,432],[117,803],[549,277],[546,604],[563,996],[951,250],[954,624],[909,970]],f=48,h=window.location.href.substring(0,window.location.href.indexOf("?text"));$(window).on("load resize",function(){r=$(window).height()-200,u>r?r=u:r>c&&(r=c),o()}),$("body").on("click keyup",function(){n()}),$("#text").bind("input",function(){$(this).val($(this).val().replace(/[^A-Za-z\s]/g,"")),document.getElementById("text").value=document.getElementById("text").value.toUpperCase(),t(d),window.history.pushState("","",h+"?text="+$(this).val().toLowerCase())}),$("#pic").on("change",function(){var t=new FileReader;$(t).on("load",function(t){document.getElementById("image").src=t.target.result}),t.readAsDataURL(this.files[0])}),$("img#image").on("load",function(){t(d)}),$("#upload").on("click",function(){$("#pic").trigger("click")}),$("#download").on("click",function(){e($(this),"pablo","pablo.png")})});